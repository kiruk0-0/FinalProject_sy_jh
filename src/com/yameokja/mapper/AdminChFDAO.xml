<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.yameokja.mc.IAdminFindDAO">
	
	<!-- 리뷰신고 요청자로 요청내용 찾기 
	리뷰신고 요청자로 요청내용 찾기
	신고자, 신고일, 피신고자, 작성일, 리뷰신고카테고리명, 가게이름
	-->
	<select id="rvSearch" resultType="com.yameokja.mc.RvApplyViewDTO">
		
		SELECT RRV.REP_APPLY_NUM AS REP_APPLY_NUM
		     , RRV.USER_ID AS USER_ID
		     , TO_CHAR(RRV.REG_DATE, 'YYYY-MM-DD') AS REG_DATE
		     , RRV.ACCU_NUM AS ACCU_NUM
		     , TO_CHAR(RB.REG_DATE,'YYYY-MM-DD') AS WRITE_DATE
		     , RRV.REP_RS_NAME AS REP_RS_NAME
		     , RRV.ST_NAME AS ST_NAME
		     , RB.ST_NUM AS ST_NUM
		     , RB.RV_CONTENT AS RV_CONTENT
		FROM RV_REPORT_VIEW RRV
		LEFT JOIN RV_BOX RB
		ON RRV.RV_NUM = RB.RV_NUM
		WHERE RRV.REP_APPLY_NUM=#{rep_apply_num}
		
		
		
		<!-- 
		SELECT RRV.REP_APPLY_NUM AS REP_APPLY_NUM
		     , RRV.USER_ID AS USER_ID
		     , RRV.REG_DATE AS REG_DATE
		     , RRV.ACCU_NUM AS ACCU_NUM
		     , RB.REG_DATE AS WRITE_DATE
		     , RRV.REP_RS_NAME AS REP_RS_NAME
		     , RRV.ST_NAME AS ST_NAME
		     , RRV.STATE AS STATE
		     , RRV.FINAL_DATE AS FINAL_DATE
		     , RRV.ADMIN_ID AS ADMIN_ID
		FROM RV_REPORT_VIEW RRV
		LEFT JOIN RV_BOX RB
		ON RRV.USER_NUM = RB.USER_NUM
		WHERE REP_APPLY_NUM=#{rep_apply_num};
		 -->
	</select>
		
	<!-- 정보수정 요청한 내용 가져오기
	가게명 체크박스항목명 여부명 정보오류요청사유 요청자
	-->
	<select id="accuSearch" resultType="com.yameokja.mc.ReqApplyViewDTO">
		SELECT REQ_APPLY_NUM, ST_NAME, CHBOX_NAME, YN_NAME, REQ_RS, USER_ID, ST_NUM
		FROM REQ_APPLY_VIEW
		WHERE REQ_APPLY_NUM = #{req_apply_num}
	</select>
	
	<!-- 이의제기 요청 내용 가져오기
	정보오류요청사유 이의제기사유 이의제기사진
	-->
	<select id="objSearch" resultType="com.yameokja.mc.ObjApplyViewDTO">
		SELECT OAV.OBJ_APPLY_NUM AS OBJ_APPLY_NUM
     		 , OAV.REQ_RS AS REQ_RS
			 , OAV.OBJ_RS AS OBJ_RS
			 , OP.PHOTO_LINK AS PHOTO_LINK
		FROM OBJ_APPLY_VIEW OAV
		LEFT JOIN OBJ_PHOTO OP
		ON OP.OBJ_APPLY_NUM = OAV.OBJ_APPLY_NUM
		WHERE OAV.OBJ_APPLY_NUM = #{obj_apply_num}
	</select>
	
	
	<!-- 패널티회수 요청 가게 내용 가져오기
	아이디 신청날짜 가게명 패널티받은사유 패널티회수요청사유 첨부파일
	-->
	<select id="revoSearch" resultType="com.yameokja.mc.RevoApplyViewDTO">
		SELECT REVO_APPLY_NUM, USER_ID, TO_CHAR(REG_DATE, 'YYYY-MM-DD') AS REG_DATE, ST_NAME, REQ_RS, REVO_RS, PHOTO_LINK
		FROM REVO_APPLY_VIEW
		WHERE REVO_APPLY_NUM = #{revo_apply_num}
	</select>
	
	
	<!-- 가게 등폐업 요청 가게 요청내용 가져오기 
	등록 → 서류파일(사업자등록증파일,사업장관리증파일), 사업자등록번호, 사업장관리번호, 가게명, 가게주소, 가게상세주소, 가게번호
	폐업 → 사업장번호(ST_PLACE_NUM) OUT_APPLY_NUM
	-->
	<select id="inSearch" resultType="com.yameokja.mc.StoreregiDTO">
		SELECT IA.REG_DATE AS REG_DATE, IA.ST_IN_NUM AS ST_IN_NUM, IA.ST_IN_FILE AS ST_IN_FILE
			 , REGEXP_SUBSTR(IA.ST_IN_FILE, '[^\\]*$') AS IN_FILE_NAME
			 , IA.ST_PLACE_NUM AS ST_PLACE_NUM, IA.ST_PLACE_FILE AS ST_PLACE_FILE
			 , REGEXP_SUBSTR(IA.ST_PLACE_FILE, '[^\\]*$') AS PLACE_FILE_NAME, UU.USER_ID AS USER_ID
			 , IA.ST_NAME AS ST_NAME, IA.ST_LOCATION AS ST_LOCATION, IA.ST_LOCATION_DT AS ST_LOCATION_DT, IA.ST_TEL AS ST_TEL
		FROM IN_APPLY IA LEFT JOIN USING_USER UU
        ON IA.USER_NUM = UU.USER_NUM
        WHERE IN_APPLY_NUM = #{in_apply_num}
	</select>
	
	<select id="outSearch" resultType="com.yameokja.mc.StoreregiDTO">
		SELECT IA.ST_PLACE_NUM AS ST_PLACE_NUM
		FROM IN_APPLY IA 
		LEFT JOIN IN_PROCESS IP
		ON IA.IN_APPLY_NUM = IP.IN_APPLY_NUM
		LEFT JOIN OUT_APPLY OA
		ON IP.IN_PROCESS_NUM = OA.IN_PROCESS_NUM
		WHERE OUT_APPLY_NUM = #{out_apply_num}
	</select>
	
	<!-- 관리자 읽은 날짜 업데이트 -->
	<update id="rvupdate">
	    UPDATE REP_APPLY
		SET ADMIN_READ_DATE = TO_DATE(SYSDATE, 'YYYY-MM-DD')
		WHERE REP_APPLY_NUM = #{rep_apply_num}
	</update>
	
	<update id="stinfoupdate">
	    UPDATE REQ_APPLY
		SET ADMIN_READ_DATE = TO_DATE(SYSDATE, 'YYYY-MM-DD')
		WHERE REQ_APPLY_NUM = #{req_apply_num}
	</update>
	
	<update id="objupdate">
	    UPDATE OBJ_APPLY
		SET ADMIN_READ_DATE = TO_DATE(SYSDATE, 'YYYY-MM-DD')
		WHERE OBJ_APPLY_NUM = #{obj_apply_num}
	</update>
	
	<update id="revoupdate">
	    UPDATE REVO_APPLY
		SET ADMIN_READ_DATE = TO_DATE(SYSDATE, 'YYYY-MM-DD')
		WHERE REVO_APPLY_NUM = #{revo_apply_num}
	</update>
	
	<update id="inapplyupdate">
	    UPDATE IN_APPLY
		SET ADMIN_READ_DATE = TO_DATE(SYSDATE, 'YYYY-MM-DD')
		WHERE IN_APPLY_NUM = #{in_apply_num}
	</update>
	
	<insert id="rvreportaccess">
		INSERT INTO REP_PROCESS(REP_PROCESS_NUM, REP_APPLY_NUM, ADMIN_NUM, FINAL_DATE, REP_READ_DATE, ACCU_READ_DATE)
                VALUES(REPPROSEQ.NEXTVAL, #{rep_apply_num}, #{admin_num}, TO_DATE(SYSDATE, 'YYYY-MM-DD'), NULL, NULL)
	
	</insert>
	
	<insert id="inprocess">
		INSERT INTO IN_PROCESS(IN_PROCESS_NUM, IN_APPLY_NUM, ADMIN_NUM, FINAL_DATE)
		VALUES(INPROSEQ.NEXTVAL, #{in_apply_num}, #{admin_num}, SYSDATE)		
	</insert>
	
		
</mapper>